<!DOCTYPE html>
<html lang="en">

<head>
  <title>Huerbook</title>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.min.js"></script>
</head>

<body>

  <div class="message_holder">
    {%for i in range(messages|length)%}
    <b>{{messages[i]}}:</b>
    {{users[i]}}<br>
    {% endfor %}
  </div>

  <form action="" method="POST">
    <input type="text" class="message" placeholder="Mensaje">
    <input type="submit">
  </form>

  <div class="logueados">
    {{logueados}}
  </div>
  <a href="/logout">Cerrrar sesion.</a>


  <aside>
    <div class="online_users">
      *Usuarios conectados*
    </div>
  </aside>


  <div id="margin">
  <form action="" method="POST">
    <p class="username" >{{username}}<p>
    <input type="text" class="message" placeholder="Escribe un Mensaje">
    <input type="submit" class="send_button">  
  </form>
  <center><a class="logout" href="/logout">Cerrar sesion.</a></center>
</div>


  <script type="text/javascript">

    //Inicia socket en localhost:5000
    var socket = io.connect('http://' + document.domain + ':' + location.port);

    //Cuando un usuario se conecta
    socket.on('connect', function () {
      //Al hacer click en enviar mensaje
      var form = $('form').on('submit', function (e) {
        e.preventDefault()
        leser_name = '{{username}}'
        let user_input = $('input.message').val()
        //Si el mensaje no esta vacio
        if (user_input != "") {
          //Envia nombre de usuario y mensaje al servidor
          socket.emit('event_message', {
            user_name: user_name, message: user_input
          })
        }
        //Limpia el input del mensaje
        $('input.message').val('').focus()
      })
    })

    //Imprime el mensaje enviado
    socket.on('response', function (msg) {
      $('div.message_holder').append('<b>' + msg.user_name + ':</b> ' + msg.message + '<br>')
    })

    //Cuando un usuario se conecta o desconecta actualiza la lista de usuarios conectadps
    socket.on('users', function (log) {
      $('div.logueados').empty()
      $('div.logueados').append(log)
    })


t u
  </script>
</body>

</html>